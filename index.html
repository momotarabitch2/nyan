<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>言いたいことも言えないこんな世の中にゃ</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6">🐾 言いたいことも言えないこんな世の中にゃ 🐾</h1>

  <div class="w-full max-w-xl space-y-4">
    <!-- 入力エリア -->
    <label for="src" class="block font-medium">人間語じゃ言えないこと:</label>
    <textarea id="src" class="w-full p-3 border rounded-lg shadow-sm focus:outline-none focus:ring" rows="6" placeholder="ここに秘密テキストを入力"></textarea>

    <!-- 変換ボタン -->
    <button id="convert" class="px-4 py-2 rounded-lg bg-indigo-500 text-white shadow hover:bg-indigo-600 transition flex items-center gap-2 justify-center">
      🐾 <span>ネコ語に変換</span> 🐾
    </button>

    <!-- 出力エリア -->
    <label for="dst" class="block font-medium">変換結果:</label>
    <textarea id="dst" class="w-full p-3 border rounded-lg shadow-sm bg-gray-100" rows="6" readonly></textarea>

    <!-- ツイートボタン -->
    <a id="tweet" href="#" target="_blank" class="block text-center px-4 py-2 rounded-lg border shadow pointer-events-none opacity-40 bg-sky-500 text-white flex items-center gap-2 justify-center">
      🐾 <span>ネコ語でついーとする</span> 🐾
    </a>

    <p class="text-xs text-gray-500">※ ツイートは公開されます。猫語でも内容の機密性は保証されません。</p>
  </div>

  <script>
    // 猫語ユニット候補
    const catUnits = ["にゃ", "にゃー", "にゃん", "にゃ〜", "にゃにゃ", "にゃーん"];
    function randomCat() {
      return catUnits[Math.floor(Math.random() * catUnits.length)];
    }

    // 1 行を同等文字数レベルの猫語へ変換
    function catifyLine(line) {
      const punctuationMatch = line.match(/[。！!？?]$/);
      const punctuation = punctuationMatch ? punctuationMatch[0] : "";
      // 句読点・空白を除いた文字数をターゲット長さとみなす
      const coreLen = line.replace(/[^\p{L}\p{N}]/gu, "").length || 1; // 0 を避ける (Unicode-aware)
      let out = "";
      while (out.length < coreLen) {
        out += randomCat();
      }
      return out + punctuation;
    }

    function toCat(text) {
      return text.split("\n").map(catifyLine).join("\n");
    }

    // UI イベント
    document.getElementById('convert').addEventListener('click', () => {
      const src = document.getElementById('src').value;
      const cat = toCat(src);
      const dst = document.getElementById('dst');
      dst.value = cat;

      // ツイートリンク更新
      const hashtag = "\n\n#なんだネコか にゃーん.jp";
      const tweetText = cat + hashtag;
      const tweetBtn = document.getElementById('tweet');
      tweetBtn.href = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(tweetText);
      tweetBtn.classList.remove('pointer-events-none', 'opacity-40');
    });
  </script>
</body>
</html>
